<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seller Dashboard | B2B Surplus</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ===== ORIGINAL DASHBOARD STYLES (UNCHANGED) ===== */
:root {
  --primary:#0d6efd;
  --success:#198754;
  --danger:#dc3545;
  --dark:#212529;
  --gray:#6c757d;
  --light:#f8f9fa;
  --bg:#f0f4f8;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--dark)}
.container{max-width:1400px;margin:auto;padding:0 1rem}

header{padding:1.5rem 0;border-bottom:1px solid #ddd;margin-bottom:2rem}
.header-top{display:flex;justify-content:space-between;align-items:center}
.logo{font-size:1.5rem;font-weight:700;color:var(--primary);text-decoration:none}

.dashboard-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}
.btn-add{background:var(--success);color:#fff;padding:.75rem 1.5rem;border:none;border-radius:50px;font-weight:600;cursor:pointer}

.form-card{background:#fff;padding:2rem;border-radius:1rem;box-shadow:0 4px 16px rgba(0,0,0,.08);margin-bottom:2rem}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.25rem}
.form-group{display:flex;flex-direction:column}
label{font-weight:500;margin-bottom:.5rem}
input,select{padding:.75rem 1rem;border:1px solid #ddd;border-radius:50px}
.fee-display{margin-top:1rem;font-weight:700}
.hidden{display:none}
</style>
</head>

<body>

<div class="container">

<header>
  <div class="header-top">
    <a class="logo">B2B Surplus</a>
    <button onclick="logout()">Sign Out</button>
  </div>
</header>

<div class="dashboard-header">
  <h2>Your Listings</h2>
  <button class="btn-add" onclick="toggleForm()">Add New Listing</button>
</div>

<form id="listingForm" class="form-card hidden">
  <div class="form-grid">

    <div class="form-group">
      <label>Item Name</label>
      <input id="name" required>
    </div>

    <div class="form-group">
      <label>Sector</label>
      <select id="sector">
        <option>Healthcare</option>
        <option>Manufacturing</option>
        <option>Retail</option>
      </select>
    </div>

    <div class="form-group">
      <label>Condition</label>
      <select id="condition">
        <option>New</option>
        <option>Used</option>
      </select>
    </div>

    <div class="form-group">
      <label>Price (£)</label>
      <input type="number" id="price" step="0.01" required>
    </div>

    <div class="form-group">
      <label>Quantity</label>
      <input type="number" id="quantity" value="1" min="1">
    </div>

    <div class="form-group">
      <label>Images</label>
      <input type="file" id="images" multiple accept="image/*">
    </div>

  </div>

  <div class="fee-display" id="feeDisplay">Listing fee: £0.00</div>

  <button type="submit" class="btn-add">Save Listing</button>
</form>

<div id="listings"></div>

</div>

<!-- ================= FIREBASE ================= -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_BUCKET"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

auth.onAuthStateChanged(user => {
  if (!user) window.location.href = "signin.html";
});

/* ===== FEE CALC ===== */
function calcFee(price){
  return price <= 100 ? 5 : (price * 0.05).toFixed(2);
}

document.getElementById('price').addEventListener('input', e=>{
  document.getElementById('feeDisplay').textContent =
    `Listing fee: £${calcFee(e.target.value || 0)}`;
});

/* ===== FORM ===== */
function toggleForm(){
  document.getElementById('listingForm').classList.toggle('hidden');
}

document.getElementById('listingForm').addEventListener('submit', async e=>{
  e.preventDefault();

  const user = auth.currentUser;
  const files = document.getElementById('images').files;
  const imageUrls = [];

  for (const file of files){
    const ref = storage.ref(`listings/${user.uid}/${Date.now()}_${file.name}`);
    await ref.put(file);
    imageUrls.push(await ref.getDownloadURL());
  }

  await db.collection('listings').add({
    ownerId: user.uid,
    name: name.value,
    sector: sector.value,
    condition: condition.value,
    price: Number(price.value),
    quantity: Number(quantity.value),
    images: imageUrls,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  e.target.reset();
  document.getElementById('feeDisplay').textContent = 'Listing fee: £0.00';
  toggleForm();
});

/* ===== LOGOUT ===== */
function logout(){
  auth.signOut();
}
</script>

</body>
</html>